#!/usr/bin/env php
<?php

declare(strict_types=1);

namespace Hschulz\bin;

use const DIRECTORY_SEPARATOR;
use function dirname;
use Phar;

/* Set required variables */
$baseDir = dirname(__DIR__);
$distDir = $baseDir . DIRECTORY_SEPARATOR . 'dist';

/* Make sure the dist dir exists */
if (!is_readable($distDir)) {
    mkdir($distDir, 0755);
}

/* Output filename */
$filename = 'check_fpm.phar';

/* Create the path to the phar file that will be created */
$pharFile = $distDir . DIRECTORY_SEPARATOR . $filename;

/*
 * Create the phar in the desired location;
 * set no flags;
 * internal alias is the filename */
$phar = new Phar($pharFile, 0, $filename);

/* Use src and vendor directories when creating the phar */
$phar->buildFromDirectory($baseDir, '~src|vendor~');

/* Prefix the default stub generated by php with a php shebang */
$stub = "#!/usr/bin/env php\n" . $phar->createDefaultStub('src/main.php');
$phar->setStub($stub);
